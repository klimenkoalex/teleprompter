<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>–¢–µ–ª–µ—Å—É—Ñ–ª—ë—Ä ‚Äî failsafe</title>
<style>
  :root{ --bg:#000; --fg:#f3f3f3; --muted:#9aa0a6; --accent:#22c55e; }
  *{ box-sizing:border-box }
  html,body{ height:100%; margin:0; background:var(--bg); color:var(--fg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif }
  body{ padding-top:env(safe-area-inset-top); padding-bottom:env(safe-area-inset-bottom) }
  .app{ display:flex; flex-direction:column; height:100dvh; gap:.5rem }
  .toolbar{
    position:sticky; top:0; z-index:3; display:flex; flex-wrap:wrap; gap:.5rem; align-items:center;
    padding:.5rem .75rem; background:rgba(18,18,18,.92); backdrop-filter:blur(6px); border-bottom:1px solid #222;
  }
  .toolbar .group{ display:flex; gap:.5rem; align-items:center; flex-wrap:wrap }
  label{ font-size:.9rem; color:var(--muted) }
  input[type="range"]{ accent-color:var(--accent) }
  button{ font:inherit; background:#111; color:var(--fg); border:1px solid #333; padding:.5rem .75rem; border-radius:.6rem; }
  button.primary{ background:var(--accent); color:#052b13; border-color:#1daa56 }
  .viewer{
    position:relative; flex:1; overflow:hidden; border-top:1px solid #222;
  }
  .mirror{ transform:scaleX(-1) }
  .script{
    position:absolute; left:8vw; right:8vw; top:8rem;
    line-height:1.8; font-size:clamp(28px, 6vw, 84px); will-change:transform;
    transform:translateY(0);
  }
  .reading .toolbar, .reading .editor{ display:none!important }
  .reading .viewer{ height:100dvh }
  .editor{ padding:.5rem .75rem; background:#0b0b0b; border-top:1px solid #222 }
  textarea{ width:100%; min-height:26dvh; background:#0c0c0c; color:var(--fg); border:1px solid #333; border-radius:.6rem; padding:.75rem; line-height:1.6 }
  .hint{ color:#bbb; font-size:.85rem }
</style>
</head>
<body>
<div class="app">
  <div class="toolbar">
    <div class="group">
      <button id="btnLoad">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç</button>
      <button id="btnPlay" class="primary">–°—Ç–∞—Ä—Ç</button>
      <button id="btnReset">–í –Ω–∞—á–∞–ª–æ</button>
      <button id="btnRead">–ß—Ç–µ–Ω–∏–µ</button>
    </div>
    <div class="group">
      <label>–®—Ä–∏—Ñ—Ç <input type="range" id="fontRange" min="24" max="120" value="84"></label>
      <label>–°–∫–æ—Ä–æ—Å—Ç—å (px/—Å) <input type="range" id="speedRange" min="10" max="300" value="140"></label>
      <label><input type="checkbox" id="chkMirror"> –ó–µ—Ä–∫–∞–ª–æ</label>
    </div>
  </div>

  <div id="viewer" class="viewer">
    <div id="script" class="script"></div>
  </div>

  <div class="editor">
    <textarea id="src" placeholder="–í—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç ‚Üí ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç¬ª. –ó–∞—Ç–µ–º ¬´–°—Ç–∞—Ä—Ç¬ª. –î–ª—è –ø–∞—É–∑ –æ—Å—Ç–∞–≤–ª—è–π –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏."></textarea>
    <div class="hint">–≠—Ç–æ—Ç —Ä–µ–∂–∏–º –¥–≤–∏–≥–∞–µ—Ç —Ç–µ–∫—Å—Ç –∫–∞–∫ –∫–∞—Ä—Ç–∏–Ω–∫—É (translateY). –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ iOS –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.</div>
  </div>
</div>

<script>
(function(){
  const $=s=>document.querySelector(s);
  const viewer=$('#viewer'), script=$('#script'), src=$('#src');
  const btnLoad=$('#btnLoad'), btnPlay=$('#btnPlay'), btnReset=$('#btnReset'), btnRead=$('#btnRead');
  const fontRange=$('#fontRange'), speedRange=$('#speedRange'), chkMirror=$('#chkMirror');

  let playing=false, last=0, offset=0;

  function render(text){
    script.style.transform='translateY(0)';
    offset=0;
    // –ø—Ä–æ—Å—Ç–∞—è –≤—Å—Ç–∞–≤–∫–∞ (–±–µ–∑ –æ–±—ë—Ä—Ç–æ–∫ –ø–æ —Å–ª–æ–≤–∞–º ‚Äî –Ω–∞–º –≤–∞–∂–Ω–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∞)
    script.textContent = text || '–î–æ–±–∞–≤—å —Ç–µ–∫—Å—Ç–∞ –ø–æ–±–æ–ª—å—à–µ, —á–µ–º –æ–¥–∏–Ω —ç–∫—Ä–∞–Ω üôÇ';
  }

  function loop(ts){
    if(!playing){ last=0; return; }
    if(!last) last=ts;
    const dt=(ts-last)/1000; last=ts;
    const speed = Number(speedRange.value);
    offset += speed * dt;
    script.style.transform = `translateY(${-offset}px)`;
    requestAnimationFrame(loop);
  }

  btnLoad.onclick=()=>{
    const t = src.value.trim();
    if(!t){ alert('–í—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç –Ω–∏–∂–µ.'); return; }
    render(t);
    localStorage.setItem('tp_script_simple', t);
  };

  btnPlay.onclick=()=>{
    playing=!playing;
    btnPlay.textContent = playing ? '–ü–∞—É–∑–∞' : '–°—Ç–∞—Ä—Ç';
    if(playing){ document.body.classList.add('reading'); requestAnimationFrame(loop); }
  };

  btnReset.onclick=()=>{
    playing=false; btnPlay.textContent='–°—Ç–∞—Ä—Ç';
    offset=0; script.style.transform='translateY(0)';
  };

  btnRead.onclick=()=> document.body.classList.toggle('reading');

  fontRange.oninput=()=>{ script.style.fontSize = fontRange.value+'px'; };
  speedRange.oninput=()=>{}; // —Å–∫–æ—Ä–æ—Å—Ç—å –±–µ—Ä—ë–º –ø—Ä—è–º–æ –∏–∑ range

  chkMirror.onchange=()=> viewer.classList.toggle('mirror', chkMirror.checked);

  // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
  (function(){
    const saved = localStorage.getItem('tp_script_simple');
    if(saved){ src.value = saved; render(saved); }
    // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —á—Ç–æ-—Ç–æ –¥–ª–∏–Ω–Ω–µ–µ —ç–∫—Ä–∞–Ω–∞
    if(!src.value){
      const demo=`–≠—Ç–æ –¥–µ–º–æ failsafe-—Ä–µ–∂–∏–º–∞. 
–û–Ω –¥–≤–∏–≥–∞–µ—Ç —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ CSS transform, –∞ –Ω–µ —Å–∫—Ä–æ–ª–ª–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.
–≠—Ç–æ –Ω–∞–¥—ë–∂–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ iPhone. 
–î–æ–±–∞–≤—å —Å—é–¥–∞ –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, –Ω–∞–∂–º–∏ ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç¬ª, –ø–æ—Ç–æ–º ¬´–°—Ç–∞—Ä—Ç¬ª. 

–ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ ‚Äî —ç—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–∞—É–∑—ã. 
–®—Ä–∏—Ñ—Ç –∏ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–≥—É–ª–∏—Ä—É—é—Ç—Å—è –ø–æ–ª–∑—É–Ω–∫–∞–º–∏.`;
      src.value = demo;
      render(demo);
    }
    script.style.fontSize = fontRange.value+'px';
  })();
})();
</script>
</body>
</html>
